<?phprequire_once '../../inc/db_connect.php';
$kelas=$_GET['kelas'];$mp=$_GET['mp'];$materi=$_GET['materi'];
$ab=substr($kelas,0,1);$sql = "select * from tp where kelas='$ab' and lm='$materi' and mapel='$mp' order by tp asc";$query = $connect->query($sql);$mapel=$connect->query("select * from mata_pelajaran where id_mapel='$mp'")->fetch_assoc();if($materi==0){	echo "<div class='alert alert-info alert-dismissible'><h4><i class='icon fa fa-info'></i> Informasi</h4>Silahkan Pilih Materi</div>";}else{?>	<button type="button" class="btn rounded-0 btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#modaltujuan">Tujuan Pembelajaran</button>	<input type="hidden" class="form-control" id="materi" name="materi" value="<?=$materi;?>">	<table class="table table-bordered table-striped table-vcenter js-dataTable-full" id="tpTable">        <thead>            <tr>                <th>Kode TP</th>				<th>Tujuan Pembelajaran</th>				<th class="d-none d-sm-table-cell"></th>            </tr>        </thead>        <tbody>			<?php 			while($s=$query->fetch_assoc()) {				$ids=$s['id_tp'];			?>			<tr>				<td><?=$s['tp'];?></td>				<td><?=$s['nama_tp'];?></td>				<td>					<button class="btn btn-effect-ripple btn-xs btn-danger" onclick="removeTujuan('<?=$ids;?>')"> <i class="fa fa-trash"></i></button>				</td>			</tr>			<?php 			}			?>                          </tbody>    </table>	<div class="modal" id="modaltujuan" tabindex="-1" role="dialog" aria-labelledby="modal-normal" aria-hidden="true">        <div class="modal-dialog" role="document">            <div class="modal-content">				<form class="form-horizontal" action="modul/materi/tambahtujuan.php" autocomplete="off" method="POST" id="buattujuan">					<div class="fetched-data"></div>				</form>            </div>        </div>    </div><?php };
?><script>$("#tpTable").DataTable({pageLength:5,lengthMenu:[[5,10,20],[5,10,20]],autoWidth:!1});		$("#buattujuan").unbind('submit').bind('submit', function() {			var form = $(this);			//submi the form to server			$.ajax({				url : form.attr('action'),				type : form.attr('method'),				data : form.serialize(),				dataType : 'json',				success:function(response) {					if(response.success == true) {						$("#modaltujuan").modal('hide');						Codebase.helpers('jq-notify', {							align: 'center',             // 'right', 'left', 'center'							from: 'bottom',                // 'top', 'bottom'							type: 'success',               // 'info', 'success', 'warning', 'danger'							icon: 'fa fa-info me-5',    // Icon class							message: response.messages						});						//swal(response.messages, {buttons: false,timer: 2000,});						var kelas = $('#kelas').val();						var smt = $('#smt').val();						var mp = $('#mp').val();						var materi = $('#materi').val();						$("#tpTable").DataTable({						  pageLength: 5,						  lengthMenu: [							 [5, 10, 20],							 [5, 10, 20],						  ],						  autoWidth: !1,						  responsive: !0,						  "destroy":true,						  "searching": true,						  "paging":true,						  "ajax": "modul/materi/tujuan-pembelajaran.php?kelas="+kelas+"&smt="+smt+"&mp="+mp+"&lm="+materi						});						//$("#createKDFormk")[0].reset();						// this function is built in function of datatables;					} else {						Codebase.helpers('jq-notify', {							align: 'center',             // 'right', 'left', 'center'							from: 'bottom',                // 'top', 'bottom'							type: 'success',               // 'info', 'success', 'warning', 'danger'							icon: 'fa fa-info me-5',    // Icon class							message: response.messages						});					}  // /else				} // success  			}); // ajax subit 							return false;		}); // /submit form for Tujuan		$('#modaltujuan').on('show.bs.modal', function (e) {            var kelas = $('#kelas').val();			var materi = $('#materi').val();			var smt = $('#smt').val();			var mp = $('#mp').val();            //menggunakan fungsi ajax untuk pengambilan data            $.ajax({                type : 'post',                url : 'modul/materi/modal_tujuan.php',                data :  'kelas='+ kelas+"&smt="+smt+"&mp="+mp+"&lm="+materi,				beforeSend: function()						{								$(".fetched-data").html('<div class="block block-rounded"><div class="block-content">Loading.....<br/><div class="spinner-grow spinner-grow text-primary" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-secondary" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-success" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-danger" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-warning" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-info" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-light" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-dark" role="status"><span class="sr-only">Loading...</span></div></div></div>');						},                success : function(data){                $('.fetched-data').html(data);//menampilkan data ke dalam modal                }            });        });	function removeTujuan(id = null) {		if(id) {			// click on remove button						Swal.fire({			  title: 'Yakin dihapus?',			  text: "Apakah anda yakin menghapus Tujuan Pembelajaran ini?",			  icon: 'warning',			  showCancelButton: true,			  confirmButtonColor: '#3085d6',			  cancelButtonColor: '#d33',			  confirmButtonText: 'Ya, Hapus!'			}).then((result) => {			  if (result.isConfirmed) {				$.ajax({						url: 'modul/materi/hapustujuan.php',						type: 'post',						data: {member_id : id},						dataType: 'json',						success:function(response) {							if(response.success == true) {														// refresh the table								var kelas = $('#kelas').val();								var smt = $('#smt').val();								var mp = $('#mp').val();								var materi = $('#materi').val();								$("#tpTable").DataTable({								  pageLength: 5,								  lengthMenu: [									 [5, 10, 20],									 [5, 10, 20],								  ],								  autoWidth: !1,								  responsive: !0,								  "destroy":true,								  "searching": true,								  "paging":true,								  "ajax": "modul/materi/tujuan-pembelajaran.php?kelas="+kelas+"&smt="+smt+"&mp="+mp+"&lm="+materi								});								Codebase.helpers('jq-notify', {									align: 'center',             // 'right', 'left', 'center'									from: 'bottom',                // 'top', 'bottom'									type: 'success',               // 'info', 'success', 'warning', 'danger'									icon: 'fa fa-info me-5',    // Icon class									message: 'Tujuan Pembelajaran berhasil dihapus!'								});							} else {								Swal.fire(								  'Cancel!',								  'Tidak akan dihapus',								  'success'								)							}						}					});			  }			})					} else {			Swal.fire(								  'Error!',								  'Error: Refresh the page again',								  'error'								)		}	}</script>